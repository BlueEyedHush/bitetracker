/**
 * Main application routes
 */

'use strict';

import path from 'path';
import config from 'server/config/environment';
import errors from './components/errors';

import createGroceryListRouter from 'server/api/grocery_list/grocery_list.routes';

export default function(eh, db) {
  // Insert routes below
  eh.use('/api/foods', require('./api/food').default);
  eh.use('/api/food_groups', require('./api/food/food_group').default);
  eh.use('/api/recipes', require('./api/recipe').default);
  eh.use('/api/users', require('./api/user').default);
  eh.use('/api/grocery_list', createGroceryListRouter(db));

  eh.use('/auth', require('./auth').default);

  // All undefined asset or api routes should return a 404
  eh.route('/:url(api|auth|app|index|images)/*')
    .get(errors[404]);

  // All other routes should redirect to the index.html (or return 404 if clientRoot
  // is not known
  if(config.clientRoot != null) {
    eh.route('/*')
      .get((req, res) => {
        res.sendFile(path.resolve(`${config.clientRoot}/app.html`));
      });
  } else {
    eh.route('/*').get(errors[404]);
  }
}
