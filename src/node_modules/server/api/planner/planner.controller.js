import moment from 'moment';
import Planner from './planner.model';
import BaseController from '../base';
import {respondWithResult, handleError} from '../common';

const beginningOfWeek = (date) => moment(date).startOf('week');
const endOfWeek = (date) => moment(date).endOf('week');

export default class PlannerController extends BaseController(Planner) {
  show(req, res) {
    const from = beginningOfWeek(req.query.date).toDate();
    const to = endOfWeek(from).toDate();

    return Planner.find({date: {$gte: from, $lt: to}}).exec()
      .then(planner => planner || Planner.create({date: from}))
      .then(respondWithResult(res))
      .catch(handleError(res));
  }
}

