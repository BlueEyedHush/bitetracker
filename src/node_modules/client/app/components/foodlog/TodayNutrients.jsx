import React from 'react';
import {Grid, Row, Col, ProgressBar} from 'react-bootstrap';
import {NUTRIENTS_MAP} from 'client/sharedjs/NutrientsIDs';

const TodayNutrients = ({userIntake, dataReady, values, units}) => {
  const progress = values ? values[NUTRIENTS_MAP['energy']] * 100 / userIntake : 0;
  let progressStyle = 'success';
  if (progress > 75) progressStyle = 'warning';
  if (progress > 90) progressStyle = 'danger';

  return (
    <Grid>
      <Row>Intake (daily)</Row>
      <Row>
        <ProgressBar now={progress > 100 ? 100 : progress} label={`${progress}%`} bsStyle={progressStyle} />
        <span>{userIntake} kcal</span>
      </Row>
      <Row>
        {['Energy', 'Proteins', 'Fat', 'Carbohydrates'].map(label =>
          (<Col sm={3}>{dataIfReadyOrZero(label, dataReady, values, units)}</Col>)
        )}
      </Row>
    </Grid>
  );
};

/* http://stackoverflow.com/a/18358056 */
function roundToTwo(num) {
  return +(Math.round(num + "e+2") + "e-2");
}

function dataIfReadyOrZero(label, dataReady, values, units) {
  const id = NUTRIENTS_MAP[label.toLowerCase()];
  const defaultReply = `${label}: -`;

  if (dataReady) {
    if (!values[id]) {
      return defaultReply;
    } else {
      const formattedValue = roundToTwo(values[id]);
      return `${label}: ${formattedValue} ${units[id]}`;
    }
  } else {
    return defaultReply;
  }
}

export default TodayNutrients;
