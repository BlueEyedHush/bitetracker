import React, {PropTypes} from 'react';
import moment from 'moment';
import Planner from 'schemas/PlannerSchema';
import {mealTypes} from 'schemas/PlannerEntrySchema';
import {instanceOfMoment} from 'proptypes/moment';

import PlannerEntry from './PlannerEntry';

const entries = (planner, day, meal) => {
  const plan = planner.find(plan => moment(plan.date).startOf('day').isSame(day));
  return plan ? plan.entries.filter(entry => entry.meal === meal) : [];
};

const MealEntries = ({planner, meal, days, onEntryClick}) => (
  <tr>
    {days.map(day => (
      <td key={day.unix()} onDoubleClick={() => onEntryClick(day, meal)}>
        {entries(planner, day, meal).map(entry => (
          <PlannerEntry entry={entry} key={entry._id} />
        ))}
      </td>
    ))}
  </tr>
);

MealEntries.propTypes = {
  planner: Planner.isRequired,
  meal: PropTypes.oneOf(mealTypes).isRequired,
  days: PropTypes.arrayOf(instanceOfMoment).isRequired,
  onEntryClick: PropTypes.func,
};

MealEntries.defaultProps = {
  onEntryClick: () => {},
};

export default MealEntries;
