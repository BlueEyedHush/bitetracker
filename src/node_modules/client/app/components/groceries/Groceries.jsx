import { mix } from 'mixwith'

import React from 'react'

import GroceryListActions from 'actions/GroceryListActions'
import GroceryListStore from 'stores/GroceryListStore'
import StoreStateSubscriber from 'util/mixins/StoreStateSubscriber'

export default class Groceries extends mix(React.Component).with(StoreStateSubscriber(GroceryListStore)) {
  constructor(props) {
    super(props);
  }

  componentDidMount() {
    super.componentDidMount();
    GroceryListActions.fetchLists();
  }

  getListNodes() {
    return this.state.lists.map(list => {
      let itemNodes = list.items.map(item => {
        if (!item.completed) {
          return <li key={item._id}>{item.name}</li>;
        } else {
          return <li key={item._id}>
            <del>{item.name}</del>
          </li>;
        }
      });
      return (
          <div key={list._id}>
            <h3>{list.title}</h3>
            <ul>{itemNodes}</ul>
          </div>
      );
    });
  }

  render() {
    return (
        <div>
          <h2>Groceries</h2>
          {this.getListNodes()}
        </div>
    );
  }
}