import assign from 'lodash/assign';
import React from 'react';
import GroceryListActions from 'actions/GroceryListActions';
import GroceryListStore from 'stores/GroceryListStore';
import StoreStateSubscriber from 'mixins/StoreStateSubscriber';

import GroceriesView from './GroceriesView';

const groceryListSubscriber = StoreStateSubscriber(GroceryListStore);

export default class Groceries extends groceryListSubscriber(React.Component) {
  constructor(...args) {
    super(...args);

    this.state = assign({}, this.state, {list: {title: '', items: []}});

    this.handleTitleChange = this.handleTitleChange.bind(this);
  }

  componentDidMount() {
    super.componentDidMount();
    GroceryListActions.fetchLists();
  }

  handleTitleChange(title) {
    this.setState({list: assign({}, this.state.list, {title})});
  }

  render() {
    const activeList = this.state.lists.find(list => list._id == this.props.params.id);

    return (<GroceriesView lists={this.state.lists}
                           activeList={activeList}
                           onTitleChange={this.handleTitleChange}
                           onListSubmit={() => GroceryListActions.addList(this.state.list)}
                           onListDelete={(listId) => GroceryListActions.removeList(listId)} />);
  }
}
