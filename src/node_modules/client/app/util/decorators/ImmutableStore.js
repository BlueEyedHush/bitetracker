import Immutable from 'immutable'

export default function immutable(StoreModel) {
  StoreModel.config = _.defaults({}, StoreModel.config, {
    /**
     * Will merge the current state with next state if state is not a single immutable collection
     * Otherwise sets state to the next state
     *
     * @param currentState
     * @param nextState
     * @returns {*} new state
     */
    setState(currentState, nextState) {
      if (!(currentState instanceof Immutable.Collection)) {
        this.state = Object.assign({}, currentState, nextState);
      } else {
        this.state = nextState;
      }
      return this.state = nextState;
    },

    getState(currentState) {
      return currentState
    },

    onSerialize(state) {
      return state.toJS()
    },

    onDeserialize(data) {
      return Immutable.fromJS(data)
    }
  });

  return StoreModel;
}